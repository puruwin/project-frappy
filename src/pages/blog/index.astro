---
import "~/styles/index.css";
import BlogCard from "../../components/BlogCard.astro";
import { getAllPosts, getAllTags } from "../../utils/blog";

const allPosts = await getAllPosts();
const allTags = getAllTags(allPosts);

// SEO
const { site } = Astro;
const pageUrl = `${site}/blog`;
const image = new URL("splash.png", site);
const title = "Blog de Frapp√© | Desarrollo Web, SEO y Marketing Digital";
const description =
  "Art√≠culos sobre desarrollo web, SEO, marketing digital y tecnolog√≠a para pymes y startups. Consejos pr√°cticos y gu√≠as actualizadas.";
const keywords =
  "blog desarrollo web, blog SEO, marketing digital, desarrollo web Espa√±a, blog tecnolog√≠a";
---

<!doctype html>
<html lang="es" class="dark scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <link rel="canonical" href={pageUrl} />

    <!-- Control de robots -->
    <meta name="robots" content="index, follow" />
    <meta name="googlebot" content="index, follow" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={pageUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <meta property="og:locale" content="es_ES" />
    <meta property="og:site_name" content="Frapp√©" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={pageUrl} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={image} />

    <!-- Metadatos adicionales -->
    <meta name="author" content="Frapp√©" />
    <meta name="theme-color" content="#000000" />
    <meta name="format-detection" content="telephone=no" />

    <!-- Schema Markup: Blog -->
    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": "Blog",
        "name": "Blog de Frapp√©",
        "url": pageUrl,
        "description": description,
        "publisher": {
          "@type": "Organization",
          "name": "Frapp√©",
          "logo": {
            "@type": "ImageObject",
            "url": `${site}/frappe_icon.svg`
          }
        }
      })}
    </script>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/frappe_icon.svg" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body
    class="bg-gray-50 font-sans antialiased dark:bg-gray-900"
    style="font-family: var(--font-sans);"
  >
    <!-- Hero con gradiente y navegaci√≥n -->
    <header class="relative overflow-hidden">
      <!-- Fondo gradiente -->
      <div
        class="absolute inset-0 bg-gradient-to-br from-[#f9d034] via-[#29c1f1] to-[#f5478f]"
      ></div>

      <!-- Nav -->
      <nav
        class="relative z-20 mx-auto flex max-w-7xl items-center justify-between px-4 py-6 sm:px-6 lg:px-8"
      >
        <a href="/" class="flex items-center gap-2 font-bold text-gray-900 text-xl">
          <img src="/frappe_icon.svg" alt="Frapp√©" class="h-10 w-10" />
          <span>Frapp√©</span>
        </a>

        <div class="hidden items-center gap-8 md:flex">
          <a
            href="/"
            class="font-medium text-gray-900 transition-all hover:scale-110"
          >
            Inicio
          </a>
          <a
            href="/blog"
            class="font-medium text-gray-900 transition-all hover:scale-110"
          >
            Blog
          </a>
          <a
            href="/contacto"
            class="font-medium text-gray-900 transition-all hover:scale-110"
          >
            Contacto
          </a>
        </div>
      </nav>

      <!-- Hero -->
      <div
        class="relative z-10 mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8 lg:py-16"
      >
        <div class="text-center">
          <h1
            class="mb-4 font-bold text-[#111827] drop-shadow-lg text-3xl sm:text-4xl lg:text-5xl"
          >
            Desarrollo Web, SEO y Marketing Digital
          </h1>
          <p
            class="mx-auto max-w-2xl text-[#111827] drop-shadow-md text-lg sm:text-xl"
          >
            Art√≠culos pr√°cticos sobre <strong>desarrollo web moderno</strong>,{" "}
            <strong>SEO</strong> y <strong>marketing digital</strong> para pymes
            y startups. Gu√≠as actualizadas y consejos reales.
          </p>
        </div>
      </div>

      <!-- Separador onda -->
      <svg
        class="absolute bottom-0 left-0 h-16 w-full text-gray-50 dark:text-gray-900"
        preserveAspectRatio="none"
        viewBox="0 0 1440 200"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill="currentColor"
          d="M0,80 Q120,50 240,80 T480,80 Q600,50 720,80 T960,80 Q1080,50 1200,80 T1440,80 L1440,200 L0,200 Z"
        />
      </svg>
    </header>

    <!-- Contenido principal -->
    <main class="bg-gray-50 dark:bg-gray-900">
      <!-- Filtros y Posts -->
      <section class="px-4 py-16 sm:px-6 lg:px-8 lg:py-24">
        <div class="mx-auto max-w-7xl">
          <!-- Filtros por tags -->
          {allTags.length > 0 && (
            <div class="mb-12">
              <h2 class="mb-6 text-center font-bold text-gray-900 text-2xl dark:text-white">
                Filtrar por tema
              </h2>
              <div
                class="flex flex-wrap justify-center gap-3"
                id="filter-buttons"
              >
                <button
                  class="filter-btn active rounded-full bg-gradient-to-r from-[#29c1f1] to-[#f5478f] px-6 py-2 font-semibold text-white shadow-lg transition-all hover:scale-105"
                  data-tag="all"
                >
                  Todos
                </button>
                {allTags.map((tag) => (
                  <button
                    class="filter-btn rounded-full border-2 border-gray-300 bg-white px-6 py-2 font-semibold text-gray-700 transition-all hover:scale-105 hover:border-[#29c1f1] dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300"
                    data-tag={tag}
                  >
                    {tag}
                  </button>
                ))}
              </div>
            </div>
          )}

          <!-- Grid de posts -->
          <div
            id="posts-grid"
            class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3"
          >
            {allPosts.map((post) => (
              <BlogCard post={post} />
            ))}
          </div>

          <!-- Mensaje cuando no hay posts -->
          <div
            id="no-posts-message"
            class="hidden text-center"
          >
            <p class="text-gray-600 text-lg dark:text-gray-400">
              No hay posts disponibles para este filtro.
            </p>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 px-4 py-12 text-white sm:px-6 lg:px-8">
      <div class="mx-auto max-w-7xl">
        <div
          class="flex flex-col items-center justify-between gap-6 md:flex-row"
        >
          <div class="flex items-center gap-3">
            <img src="/frappe_icon.svg" alt="Frapp√©" class="h-10 w-10" />
            <div>
              <span class="block font-bold text-xl">Frapp√©</span>
              <span class="text-gray-400 text-sm">Desarrollo Web y Marketing Digital</span>
            </div>
          </div>
          <nav class="flex flex-wrap justify-center gap-6">
            <a href="/" class="transition-colors hover:text-[#29c1f1]">
              Inicio
            </a>
            <a href="/blog" class="transition-colors hover:text-[#29c1f1]">
              Blog
            </a>
            <a href="/contacto" class="transition-colors hover:text-[#29c1f1]">
              Contacto
            </a>
          </nav>
          <a
            href="/privacidad"
            target="_blank"
            rel="noopener noreferrer"
            class="transition-colors hover:text-[#29c1f1]"
          >
            Pol√≠tica de Privacidad
          </a>
        </div>
        <div
          class="mt-8 border-t border-gray-800 pt-8 text-center text-gray-400"
        >
          <p>
            ¬© {new Date().getFullYear()} Frapp√©. Hecho con üíô en Espa√±a.
          </p>
        </div>
      </div>
    </footer>

    <!-- Force Dark Mode Script -->
    <script>
      (function () {
        document.documentElement.classList.add("dark");
      })();
    </script>

    <!-- Script de filtrado -->
    <script>
      const filterButtons = document.querySelectorAll(".filter-btn");
      const postsGrid = document.getElementById("posts-grid");
      const noPostsMessage = document.getElementById("no-posts-message");
      const posts = Array.from(postsGrid?.children || []);

      const handleFilter = (tag: string) => {
        // Actualizar botones activos
        filterButtons.forEach((btn) => {
          const btnTag = btn.getAttribute("data-tag");
          if (btnTag === tag) {
            btn.classList.remove("border-gray-300", "bg-white", "text-gray-700", "dark:border-gray-600", "dark:bg-gray-800", "dark:text-gray-300");
            btn.classList.add("bg-gradient-to-r", "from-[#29c1f1]", "to-[#f5478f]", "text-white", "border-transparent", "shadow-lg");
          } else {
            btn.classList.remove("bg-gradient-to-r", "from-[#29c1f1]", "to-[#f5478f]", "text-white", "border-transparent", "shadow-lg");
            btn.classList.add("border-gray-300", "bg-white", "text-gray-700", "dark:border-gray-600", "dark:bg-gray-800", "dark:text-gray-300");
          }
        });

        // Filtrar posts
        let visibleCount = 0;
        posts.forEach((post) => {
          const postElement = post as HTMLElement;
          const postTags = postElement.getAttribute("data-tags")?.toLowerCase() || "";
          
          if (tag === "all" || postTags.includes(tag.toLowerCase())) {
            postElement.style.display = "block";
            visibleCount++;
          } else {
            postElement.style.display = "none";
          }
        });

        // Mostrar/ocultar mensaje de no posts
        if (visibleCount === 0) {
          noPostsMessage?.classList.remove("hidden");
          postsGrid?.classList.add("hidden");
        } else {
          noPostsMessage?.classList.add("hidden");
          postsGrid?.classList.remove("hidden");
        }
      };

      filterButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const tag = btn.getAttribute("data-tag") || "all";
          handleFilter(tag);
        });
      });
    </script>

    <!-- Animaciones suaves -->
    <style>
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      html {
        transition: background-color 0.3s ease;
        scroll-behavior: smooth;
      }
      * {
        transition:
          background-color 0.3s ease,
          border-color 0.3s ease,
          color 0.3s ease;
      }
      body {
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          "Roboto",
          sans-serif;
      }
      #posts-grid > * {
        animation: fadeInUp 0.5s ease-out;
      }
    </style>
  </body>
</html>
